# AGENTS.md

> 本文件定义：在 ahogek-blog 仓库里，Agent 应如何理解需求、修改代码、验证质量并交付说明。  
> 强调：默认不替用户做 Git 闭环（提交/推送/PR/发布），除非用户明确要求。

## 最高优先级规则（硬性）

- ⚠️ **简体中文硬规则**：Agent 必须全程使用简体中文与用户交互；不管是回答还是思考过程的表述，都必须是简体中文。
- ⚠️ **不做 Git 闭环**：除非用户明确提出，否则 Agent 不主动执行或要求执行 commit、push、开/更改
  PR、合并、发版、部署、回滚等动作；相关决策与操作完全交由用户。
- ⚠️ **外部副作用先确认**：任何可能影响线上环境、远端系统、第三方服务、数据安全的动作（例如部署、改环境变量、改域名、改 CDN
  策略等），必须先说明变更点、风险与回退方案，等待用户确认后再继续。
- ⚠️ **需求不清先澄清**：目标、范围、验收标准不明确时，先问清关键问题再改代码，避免“自作主张式重构”。

## 项目与工具约定

- 任务跟踪使用 bd（beads）：
    - bd onboard：初始化/上手
    - bd ready：查看可做任务
    - bd show <id>：查看任务详情
    - bd update <id> --status in_progress：领取/标记进行中
    - bd close <id>：完成关闭
- 项目常用命令（开发/构建/预览）：
    - pnpm dev：启动开发服务
    - pnpm dev-host：启动开发服务（可局域网访问）
    - pnpm build：生产构建（输出到 dist/）
    - pnpm preview：本地预览生产构建
- 额外说明：
    - 即使 package.json 没配置脚本，仍可直接运行二进制（例如 pnpm tsc、pnpm eslint），以本仓库依赖实际安装情况为准。

## 工作方式（偏现代工程实践）

- 先对齐：
    - 用一句话复述“要解决的问题”和“不做的事情”。
    - 给出验收标准（用户看什么算完成）：页面行为、样式一致性、构建是否通过、是否影响 SEO/路由/资源加载等。
- 再落地：
    - 尽量小步修改，避免无关重构；确需重构时先解释动机与影响面。
    - 改动要可回退：避免把多件不相关的事混在一起。
- 最后交付：
    - 交付必须包含：改了什么、改了哪些文件、如何验证、潜在回归点与排查方向。

## 质量门禁（Agent 必跑）

> 只要 Agent 改了代码或配置，就必须在交付前完成这些验证；任何一步失败都不算完成。

- TypeScript 类型检查（必须）：
    - pnpm tsc --noEmit
- ESLint 静态检查（必须）：
    - pnpm eslint src/
- 生产构建（必须）：
    - pnpm build
- 本地预览抽查（建议，但出现路由/资源/SSR/静态导出相关改动时视为必须）：
    - pnpm preview

补充要求：

- Agent 必须在交付说明里写清楚“上述门禁是否全部通过”，以及失败时的报错摘要与修复建议（不要把报错全文原样粘贴到对话里，优先给出关键段落与定位思路）。

## 测试策略（严格，但不越权）

> 目标：修 Bug / 加功能时，Agent 需要“自证正确”，不能只靠用户 review。

- 如果仓库已经存在可运行的测试体系（例如 unit / component / e2e）：
    - Agent 必须运行对应测试命令，并在交付说明里标注通过情况。
- 如果仓库当前没有测试体系或没有现成 test 脚本：
    - Agent 仍必须给出“可复现的验证清单”，包括：操作步骤、输入数据、预期结果、边界条件（至少覆盖：正常路径 + 1~2 个边界/异常场景）。
    - 当改动涉及可测试的纯逻辑（例如工具函数、数据处理、状态机、解析器等），Agent 应优先补充最小化的自动化测试；但凡需要引入新依赖/新框架（例如
      Vitest、Playwright、Testing Library 等），必须先征得用户同意再改依赖。
    - 若用户不同意引入测试框架，Agent 需要把“为什么无法添加自动化测试”讲清楚，并强化手动验证清单与回归点提示。

## 代码风格与协作约定（中文化）

- 格式化：
    - 字符串使用单引号。
    - 不写分号。
    - 缩进 2 空格，行尾 LF。
- TypeScript：
    - 倾向严格、显式的类型边界；对外导出函数建议声明返回类型。
    - 对象结构优先 interface（当它能提升可读性/可维护性时）。
- 命名：
    - 组件使用 PascalCase，函数/变量使用 camelCase，常量使用 UPPER_SNAKE_CASE。
- 注释：
    - 项目语境与关键决策点用中文说明，优先解释“为什么这么做”。

## 交付输出（每次都要有）

- 变更点清单：做了什么、为什么这么做。
- 文件清单：列出修改/新增的文件路径。
- 验证清单：
    - 质量门禁命令与结果（通过/失败与原因）。
    - 测试情况（若有自动化测试：命令与结果；若没有：手动验证步骤与预期）。
- 风险提示：
    - 可能的回归点、影响范围、出现问题如何快速定位。
- 下一步建议（由用户决定是否执行）。
